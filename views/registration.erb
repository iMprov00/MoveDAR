<div class="card mb-4">
  <div class="card-body">
    <h1 class="card-title">Регистратура</h1>
    
    <form class="row g-3 align-items-end mb-4">
      <div class="col-md-4">
        <label for="date" class="form-label">Дата:</label>
        <input type="text" class="form-control datepicker" id="date" name="date" 
               value="<%= @target_date.strftime('%d.%m.%Y') %>">
      </div>
      <div class="col-md-4">
        <button type="submit" class="btn btn-primary">Показать</button>
      </div>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <h2 class="card-title">Пациенты на <%= @target_date.strftime('%d.%m.%Y') %></h2>
    
    <% if @patients.empty? %>
      <div class="alert alert-info">Нет данных о пациентах на выбранную дату</div>
    <% else %>
      <form method="post" action="/registration">
        <input type="hidden" name="date" value="<%= @target_date.strftime('%Y-%m-%d') %>">
        
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>ФИО</th>
                <th>Время</th>
                <th>Действия</th>
              </tr>
            </thead>
            <tbody>
              <% @patients.each do |patient| %>
                <% movement = patient.movements.find { |m| m.checkpoint.name == 'Регистратура' } %>
                <tr>
                  <td><%= h patient.full_name %></td>
                  <td>
                    <% if movement %>
                      <%= movement.recorded_at.strftime('%H:%M') %>
                    <% end %>
                  </td>
                  <td>
                    <div class="row g-2">
                      <div class="col-auto">
                        <select class="form-select patient-select" name="patient_id">
                          <option value="<%= patient.id %>"><%= patient.full_name %></option>
                        </select>
                        <input type="hidden" name="checkpoint_id" value="<%= @checkpoints.find { |c| c.name == 'Регистратура' }.id %>">
                      </div>
                      <div class="col-auto">
                        <div class="form-check">
                          <input class="form-check-input current-time-checkbox" type="checkbox" 
                                 name="current_time" value="1" id="current_time_<%= patient.id %>" checked>
                          <label class="form-check-label" for="current_time_<%= patient.id %>">
                            Текущее время
                          </label>
                        </div>
                      </div>
                      <div class="col-auto">
                        <input type="time" class="form-control time-input" name="time" 
                               value="<%= Time.now.strftime('%H:%M') %>" disabled>
                      </div>
                      <div class="col-auto">
                        <button type="submit" class="btn btn-primary">Сохранить</button>
                      </div>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </form>
    <% end %>
  </div>
</div>